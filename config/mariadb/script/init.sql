CREATE DATABASE IF NOT EXISTS ipa DEFAULT CHARACTER SET UTF8 DEFAULT COLLATE utf8_bin;
USE ipa;

CREATE TABLE IF NOT EXISTS users (
    user_id INTEGER PRIMARY KEY AUTO_INCREMENT,
    email VARCHAR(256) NOT NULL,
    password VARCHAR(512) NOT NULL,
    first_name VARCHAR(128),
    last_name VARCHAR(128),
    is_admin BOOLEAN DEFAULT FALSE NOT NULL,
    is_suspended BOOLEAN DEFAULT FALSE NOT NULL,
    last_login INTEGER,
    public_key VARCHAR(1024),
    private_key VARCHAR(4096),
    salt VARCHAR(32)
);

CREATE TABLE IF NOT EXISTS organizations (
    org_id INTEGER PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(128),
    description VARCHAR(512)
);

CREATE TABLE IF NOT EXISTS secret_keys (
    secret_id INTEGER PRIMARY KEY AUTO_INCREMENT,
    secret_key VARCHAR(1024) NOT NULL,

    user_id INTEGER NOT NULL,
    org_id INTEGER NOT NULL,
    FOREIGN KEY (user_id) REFERENCES users(user_id),
    FOREIGN KEY (org_id) REFERENCES organizations(org_id)
);

CREATE TABLE IF NOT EXISTS passwords (
    pass_id INTEGER PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(128),
    description VARCHAR(512),
    url VARCHAR(2048),
    data LONGTEXT,

    org_id INTEGER NOT NULL,
    FOREIGN KEY (org_id) REFERENCES organizations(org_id)
);

CREATE TABLE IF NOT EXISTS members (
    entry_id INTEGER PRIMARY KEY AUTO_INCREMENT,

    user_id INTEGER NOT NULL,
    org_id INTEGER NOT NULL,
    FOREIGN KEY (user_id) REFERENCES users(user_id),
    FOREIGN KEY (org_id) REFERENCES organizations(org_id)
);

INSERT INTO users
VALUES (null,
        'root@brueggli.ch',
        'xpAqjRVqgp9qAHB35AaSxIu9VyDh9eZlRueF270DzMBhqPTXdppXl5Oo5yLWtG9RfHNorgVdYn/oHkBilc/Ntw==',
        'root',
        '',
        true,
        false,
        null,
        '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',
        'YK0w33s2PmxE5LSnqGaStA=='),
       (null,
        'bernardo@bernardo.fm',
        '+n7avjR7dAknBCxBO6mGOJZ28MsQoju72B3XObXI5zC7nz7JZtYyJYdKz++kySQEHpbXJTi6SDFEjLif6jI/bQ==',
        'Bernardo',
        'de Oliveira',
        true,
        false,
        null,
        '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',
        'tbDKxkNCA7w07Pby08O/RQ==');

CREATE USER IF NOT EXISTS admin@'10.0.2.3' IDENTIFIED BY 's8IXoKZspp;y';
GRANT ALL PRIVILEGES ON ipa.* TO admin@'10.0.2.3' IDENTIFIED BY 's8IXoKZspp;y';

FLUSH PRIVILEGES;
